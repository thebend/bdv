{"version":3,"sources":["FullScreen.ts","BDVideo.tsx","AspectRatio.ts","Help.tsx","App.tsx","serviceWorker.js","index.js"],"names":["fullscreenElement","element","requestFullscreen","msRequestFullscreen","webkitRequestFullscreen","call","fsEnabled","document","fullscreenEnabled","msFullscreenEnabled","webkitFullscreenEnabled","fsExit","exitFullscreen","msExitFullscreen","webkitExitFullscreen","bind","browser","navigator","userAgent","indexOf","msBrowser","VIDEO_MARGINS","edge","left","right","bottom","chrome","margins","BDVideo","_React$Component","props","_this","Object","classCallCheck","this","possibleConstructorReturn","getPrototypeOf","video","React","createRef","thumbnail","dragMargin","thumbnailWidth","thumbnailMargin","hoverThumbnail","e","current","height","layerY","setState","thumbnailState","undefined","timelineWidth","width","videoPercentage","layerX","targetTime","duration","offsetX","timestamp","state","inherits","createClass","key","value","_this$props","inTime","outTime","ontimeupdate","pastOut","currentTime","beforeIn","_this$props2","playbackRate","showThumbnail","rate","setIO","onmouseover","_this2","_this$props3","display","onLoad","onError","onDrag","startTime","onload","onerror","onloadeddata","onloadedmetadata","ondragstart","target","offsetY","preventDefault","onmousemove","onmouseout","_this$props4","ip","op","ix","ox","react_default","a","createElement","Fragment","IOMarker","offset","color","adjustment","percentage","arguments","length","end","diff","_this3","_this$props5","size","onMouseOver","onMouseOut","objectFit","showOverlay","removeCallback","copyCallback","exclusiveCallback","inCallback","outCallback","speedCallback","assign","className","onKeyDown","ev","toLowerCase","shiftKey","shiftDisplayActions","arrowleft","adjustDisplayTime","arrowright","f","ctrlKey","ctrlDisplayActions","displayActions","m","muted","console","log","style","concat","pointerEvents","file","name","onClick","getIO","controls","autoPlay","loop","src","url","ref","draggable","Component","_ref","yMargin","viewBox","diameter","cx","cy","r","fill","ASPECT_RATIOS","ratio","SHORTCUTS","id","DISCLAIMER","SelectInput","htmlFor","label","onChange","callback","choices","Help","OBJECT_FITS","map","v","i","toUpperCase","substr","objectFitCallback","aspectRatio","toString","aspectRatioCallback","parseInt","SPLASH","stopDragDrop","stopPropagation","ErrorDisplay","errorDisplays","dismissCallback","type","onSubmit","App","viewport","globalActions","body","msFullscreenElement","webkitFullscreenElement","toggleFullscreen","h","showHelp","s","nextObjectFit","t","showThumbnails","x","nextDimensionRatio","handleDropEvent","dataTransfer","firstBatch","droppedFiles","files","videoFiles","Array","from","filter","startsWith","maxId","newDisplays","URL","createObjectURL","triggerResize","displays","handleKeyPress","d","activeDisplay","syncPlaybackRates","adjustVideoSpeed","delete","deleteDisplay","c","addDisplayCopy","distributeTimes","setVideoIO","o","fillGrid","updateDimensions","vp","clientWidth","y","clientHeight","applyOnActive","func","assertThisInitialized","ratioIndex","objectFitIndex","window","onresize","onkeydown","ondragover","ondragenter","ondragleave","ondrop","forEach","matchingDisplays","di","orderedDisplays","toConsumableArray","slice","t1","spacing","count","additions","_","newDisplay","copyDisplay","pop","_this$state","bestArea","videoRatio","rows","cols","Math","ceil","floor","vx","vy","videoArea","mode","activeVideo","arr","avgRatio","videoWidth","videoHeight","reduce","b","closestRatio","sort","abs","findIndex","getRecommendedAspectRatioIndex","_this$state2","push","dest","_this$state3","dragSrc","destDisplay","si","tmpDisplays","_this$state4","lastDisplay","getVideoSize","onDrop","reorderDisplays","BDVideo_BDVideo","setRecommendedAspectRatio","handleVideoError","in","out","staggerCallback","src_Help","isLocalhost","Boolean","location","hostname","match","registerValidSW","swUrl","config","serviceWorker","register","then","registration","onupdatefound","installingWorker","installing","onstatechange","controller","onUpdate","onSuccess","catch","error","ReactDOM","render","src_App_0","getElementById","process","href","origin","addEventListener","fetch","response","contentType","headers","get","status","ready","unregister","reload","checkValidServiceWorker"],"mappings":"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","file":"static/js/main.6f020f80.chunk.js","sourcesContent":["export function fullscreenElement(element:HTMLElement) {\r\n\t(element.requestFullscreen || (element as any).msRequestFullscreen || (element as any).webkitRequestFullscreen).call(element)\r\n}\r\n\r\nconst fsEnabled = document.fullscreenEnabled || (document as any).msFullscreenEnabled || (document as any).webkitFullscreenEnabled\r\nconst fsExit = (document.exitFullscreen || (document as any).msExitFullscreen || (document as any).webkitExitFullscreen).bind(document)\r\nexport function toggleFullscreen(target:HTMLElement = document.body) {\r\n\tif (!fsEnabled) return\r\n\tconst fsElement = document.fullscreenElement || (document as any).msFullscreenElement || (document as any).webkitFullscreenElement\r\n\tif (fsElement) {\r\n\t\tfsExit()\r\n\t} else {\r\n\t\tfullscreenElement(target)\r\n\t}\r\n}\r\n","import React from 'react'\r\nimport './BDVideo.css'\r\nimport { fullscreenElement } from './FullScreen'\r\nimport { ObjectFitProperty } from 'csstype'\r\n\r\nfunction getBrowser() {\r\n\tif (navigator.userAgent.indexOf(' Trident/') > -1) return 'IE'\r\n\tif (navigator.userAgent.indexOf(' Edge/') > -1) return 'Edge'\r\n\treturn 'Chrome'\r\n}\r\n\r\nexport const browser = getBrowser()\r\nexport const msBrowser = [\"Edge\",\"IE\"].indexOf(browser) > -1\r\n\r\ninterface ActionControls {\r\n\t[key:string]: ()=>void\r\n}\r\n\r\nconst VIDEO_MARGINS = {\r\n\t\"edge\": {\r\n\t\t\"left\": 116,\r\n\t\t\"right\": 220,\r\n\t\t\"bottom\": 24\r\n\t},\r\n\t\"chrome\": {\r\n\t\t\"left\": 24,\r\n\t\t\"right\": 24,\r\n\t\t\"bottom\": 16\r\n\t}\r\n}\r\nconst margins = browser == \"Chrome\" ? VIDEO_MARGINS[\"chrome\"] : VIDEO_MARGINS[\"edge\"]\r\n\r\nexport interface Display {\r\n\tid:number\r\n\tfile:File\r\n\turl:string\r\n\tstartTime?:number\r\n\tin?:number\r\n\tout?:number\r\n\tvideo?:HTMLVideoElement\r\n\ttriggerResize:boolean\r\n\tplaybackRate:number\r\n}\r\n\r\ninterface BDVideoProps {\r\n\tdisplay:Display\r\n\tobjectFit:ObjectFitProperty\r\n\tsize: {\r\n\t\twidth:number\r\n\t\theight:number\r\n\t}\r\n\tshowOverlay:boolean\r\n\tshowThumbnail:boolean\r\n\tinTime?:number\r\n\toutTime?:number\r\n\tplaybackRate:number\r\n\tonMouseOver:()=>void\r\n\tonMouseOut:()=>void\r\n\tonLoad:()=>void\r\n\tonError:()=>void\r\n\tonDrag:(display:Display)=>void\r\n\tremoveCallback:()=>void,\r\n\tcopyCallback:()=>void,\r\n\texclusiveCallback:()=>void,\r\n\tstaggerCallback:()=>void,\r\n\tinCallback:()=>void,\r\n\toutCallback:()=>void,\r\n\tspeedCallback:(adjustment:number)=>void\r\n}\r\n\r\ninterface BDVideoState {\r\n\tthumbnailState?:{\r\n\t\toffsetX:number,\r\n\t\ttimestamp:number\r\n\t}\r\n}\r\n\r\nexport class BDVideo extends React.Component<BDVideoProps, BDVideoState> {\r\n\tvideo = React.createRef<HTMLVideoElement>()\r\n\tthumbnail = React.createRef<HTMLVideoElement>()\r\n\r\n\tdragMargin = 80\r\n\tthumbnailWidth = 196\r\n\tthumbnailMargin = margins.bottom + 8\r\n\r\n\tconstructor(props:BDVideoProps) {\r\n\t\tsuper(props)\r\n\t\tthis.state = {}\r\n\t}\r\n\r\n\tsetIO() {\r\n\t\tconst {inTime, outTime} = this.props\r\n\t\tconst video = this.video.current!\r\n\t\tvideo.ontimeupdate = e => {\r\n\t\t\tconst pastOut = outTime && outTime < video.currentTime\r\n\t\t\tconst beforeIn = inTime && inTime > video.currentTime\r\n\t\t\tif (pastOut || beforeIn) video.currentTime = inTime || 0\r\n\t\t}\r\n\t}\r\n\r\n\thoverThumbnail = (e:MouseEvent) => {\r\n\t\tconst video = this.video.current\r\n\t\tif (!video) return\r\n\t\tconst distanceFromBottom = video.height - e.layerY\r\n\t\tif (distanceFromBottom > this.thumbnailMargin) {\r\n\t\t\tthis.setState({thumbnailState: undefined})\r\n\t\t\treturn\r\n\t\t}\r\n\t\tconst timelineWidth = video.width - margins.left - margins.right\r\n\t\tconst videoPercentage = (e.layerX - margins.left) / timelineWidth \r\n\t\tif (videoPercentage < 0 || videoPercentage > 1) {\r\n\t\t\tthis.setState({thumbnailState: undefined})\r\n\t\t\treturn\r\n\t\t}\r\n\t\tconst targetTime = video.duration * videoPercentage\r\n\t\tthis.setState({\r\n\t\t\tthumbnailState: {\r\n\t\t\t\toffsetX: e.layerX - (this.thumbnailWidth / 2),\r\n\t\t\t\ttimestamp: targetTime\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\r\n\tcomponentDidUpdate() {\r\n\t\tconst {playbackRate, showThumbnail} = this.props\r\n\t\tconst video = this.video.current!\r\n\t\tconst rate = playbackRate || 1\r\n\t\tvideo.playbackRate = rate\r\n\t\tthis.setIO()\r\n\t\tif (showThumbnail && browser != 'IE') {\r\n\t\t\tconst {thumbnailState} = this.state\r\n\t\t\tconst thumbnail = this.thumbnail.current\r\n\t\t\tif (thumbnail && thumbnailState) {\r\n\t\t\t\tthumbnail.currentTime = thumbnailState.timestamp\r\n\t\t\t}\r\n\t\t\tvideo.onmouseover = this.hoverThumbnail\r\n\t\t} else {\r\n\t\t\tvideo.onmouseover = null\r\n\t\t}\r\n\t}\r\n\r\n\tcomponentDidMount() {\r\n\t\tconst {display, onLoad, onError, onDrag, showThumbnail} = this.props\r\n\t\tconst video = this.video.current!\r\n\t\tdisplay.video = video\r\n\t\tif (display.startTime) {\r\n\t\t\tvideo.onload = () => { video.currentTime = display.startTime! }\r\n\t\t} else {\r\n\t\t\tvideo.onerror = onError\r\n\t\t\tvideo.onloadeddata = e => video.currentTime = video.duration / 2\r\n\t\t\tvideo.onloadedmetadata = onLoad\r\n\t\t}\r\n\t\tvideo.ondragstart = e => {\r\n\t\t\tconst target = e.target! as HTMLVideoElement\r\n\t\t\tconst distanceFromBottom = target.height - e.offsetY\r\n\t\t\tif (distanceFromBottom < this.dragMargin) {\r\n\t\t\t\te.preventDefault()\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\t\t\tonDrag(display)\r\n\t\t}\r\n\t\tvideo.onmousemove = showThumbnail && browser != 'IE' ? this.hoverThumbnail : null\r\n\t\tvideo.onmouseout = e => {\r\n\t\t\tthis.setState({thumbnailState: undefined})\r\n\t\t}\r\n\t\tthis.setIO()\r\n\t}\r\n\r\n\tgetIO() {\r\n\t\tconst {inTime, outTime} = this.props\r\n\t\tconst video = this.video.current!\r\n\r\n\t\tif (inTime || outTime) {\r\n\t\t\tconst duration = video.duration\r\n\t\t\tconst ip = inTime || 0\r\n\t\t\tconst op = outTime || duration\r\n\t\t\tconst timelineWidth = video.width - margins.left - margins.right\r\n\t\t\tconst ix = (ip / duration) * timelineWidth\r\n\t\t\tconst ox = (op / duration) * timelineWidth\r\n\t\t\treturn <>\r\n\t\t\t\t<IOMarker offset={ix} color=\"gold\" />\r\n\t\t\t\t<IOMarker offset={ox} color=\"gold\" />\r\n\t\t\t</>\r\n\t\t}\r\n\t}\r\n\r\n\tadjustDisplayTime(adjustment:number, percentage:boolean = false) {\r\n\t\tconst video = this.video.current!\r\n\t\tconst end = video.duration\r\n\t\tif (percentage) {\r\n\t\t\tadjustment = end * adjustment\r\n\t\t}\r\n\t\tconst diff = end - video.currentTime\r\n\t\tif (adjustment > diff) {\r\n\t\t\tvideo.currentTime = adjustment - diff\r\n\t\t} else {\r\n\t\t\tvideo.currentTime = video.currentTime + adjustment\r\n\t\t}\r\n\t}\r\n\r\n\trender() {\r\n\t\tconst {size, onMouseOver, onMouseOut, display, objectFit, showOverlay, showThumbnail, playbackRate,\r\n\t\t\tremoveCallback, copyCallback, exclusiveCallback, inCallback, outCallback, speedCallback} = this.props\r\n\t\tconst {thumbnailState} = this.state\r\n\r\n\t\treturn <div className=\"display\" {...size} onMouseOver={onMouseOver} onMouseOut={onMouseOut} onKeyDown={ev => {\r\n\t\t\tconst video = this.video.current!\r\n\t\t\tconst key = ev.key.toLowerCase()\r\n\t\t\tif (ev.shiftKey) {\r\n\t\t\t\tconst shiftDisplayActions = {\r\n\t\t\t\t\t\"arrowleft\": () => this.adjustDisplayTime(-.1, true),\r\n\t\t\t\t\t\"arrowright\": () => this.adjustDisplayTime(.1, true),\r\n\t\t\t\t\t\"f\": () => fullscreenElement(video)\r\n\t\t\t\t} as ActionControls\r\n\t\t\t\tkey in shiftDisplayActions && shiftDisplayActions[key]()\r\n\t\t\t} else if (ev.ctrlKey) {\r\n\t\t\t\tconst ctrlDisplayActions = {\r\n\t\t\t\t} as ActionControls\r\n\t\t\t\tkey in ctrlDisplayActions && ctrlDisplayActions[key]()\r\n\t\t\t} else {\r\n\t\t\t\tconst displayActions = {\r\n\t\t\t\t\t\"m\": () => video.muted = !video.muted,\r\n\t\t\t\t\t\"arrowleft\": () => this.adjustDisplayTime(-60),\r\n\t\t\t\t\t\"arrowright\": () => this.adjustDisplayTime(60),\r\n\t\t\t\t} as ActionControls\r\n\t\t\t\tkey in displayActions && displayActions[key]()\r\n\t\t\t}\r\n\t\t\tconsole.log(key)\r\n\t\t}}>\r\n\t\t\t<div className=\"display-border\" style={{width: `${size.width}px`, height: `${size.height}px`, pointerEvents: msBrowser ? 'none' : 'auto'}}>\r\n\t\t\t\t{`${display.file.name}${playbackRate == 1 ? \"\" : \" (\"+playbackRate+\"x)\"}`}\r\n\t\t\t</div>\r\n\t\t\t<div className=\"display-controls\">\r\n\t\t\t\t<button onClick={removeCallback}>X</button>\r\n\t\t\t\t<button onClick={() => copyCallback()}>C</button>\r\n\t\t\t\t<button onClick={exclusiveCallback}>E</button>\r\n\t\t\t\t<button onClick={inCallback}>I</button>\r\n\t\t\t\t<button onClick={outCallback}>O</button>\r\n\t\t\t\t<button onClick={() => speedCallback(2)}>&raquo;</button>\r\n\t\t\t\t<button onClick={() => speedCallback(0.5)}>&laquo;</button>\r\n\t\t\t</div>\r\n\t\t\t{showOverlay && this.getIO()}\r\n\t\t\t{showThumbnail && thumbnailState && <video controls={false} autoPlay={false} loop={false} muted={true} src={display.url} width={this.thumbnailWidth} className=\"thumbnail\" ref={this.thumbnail} style={{left: thumbnailState.offsetX}} />}\r\n\t\t\t<video controls={true} autoPlay={true} loop={true} muted={true} src={display.url} draggable={!msBrowser}\r\n\t\t\t\t{...size} ref={this.video} style={{objectFit}}\r\n\t\t\t\t// title={display.file.name} // causes hover to display title which gets in the way\r\n\t\t\t\t/>\r\n\t\t</div>\r\n\t}\r\n}\r\n\r\ninterface IOMarkerProps {\r\n\toffset:number,\r\n\tcolor:string\r\n}\r\nfunction IOMarker({offset, color}:IOMarkerProps) {\r\n\tconst diameter = 10\r\n\tconst yMargin = margins.bottom\r\n\treturn <svg className=\"iomarker\" width={diameter} height={diameter} viewBox={`0 0 2 2`}\r\n\t\tstyle={{bottom: yMargin + (diameter/2), left: margins.left + offset - (diameter/2)}}\r\n\t>\r\n\t\t<circle cx={1} cy={1} r={1} fill={color} />\r\n\t</svg>\r\n}\r\n","export interface AspectRatio {\r\n\tratio:number,\r\n\tname:string\r\n}\r\n\r\nexport const ASPECT_RATIOS = [{\r\n\tratio: 16/9,\r\n\tname: \"16:9 (High Def)\"\r\n}, {\r\n\tratio: 4/3,\r\n\tname: \"4:3 (Standard Def)\"\r\n}, {\r\n\tratio: 1,\r\n\tname: \"1:1 (Square)\",\r\n}, {\r\n\tratio: 9/16,\r\n\tname: \"9:16 (Vertical HD)\"\r\n}, {\r\n\tratio: 1.85,\r\n\tname: \"1.85:1 (Cinematic)\"\r\n}, {\r\n\tratio: 2.35,\r\n\tname: \"2.35:1 (Anamorphic)\"\r\n}]\r\n","import React from 'react'\r\nimport './Help.css'\r\nimport { ObjectFitProperty } from \"csstype\"\r\nimport {OBJECT_FITS} from './App'\r\nimport {AspectRatio, ASPECT_RATIOS} from './AspectRatio'\r\n\r\nconst SHORTCUTS = <section id=\"shortcuts\">\r\n\t<h2>Shortcuts</h2><ol>\r\n\t\t<li><em>C:</em> Clone video (+1m)</li>\r\n\t\t<li><em>D:</em> Distribute times</li>\r\n\t\t<li><em>E:</em> Remove everything else</li>\r\n\t\t<li><em>F:</em> Toggle fullscreen</li>\r\n\t\t<li><em>Shift+F:</em> Fullscreen video</li>\r\n\t\t<li><em>H:</em> Toggle help</li>\r\n\t\t<li><em>I:</em> Toggle in point</li>\r\n\t\t<li><em>O:</em> Toggle out point</li>\r\n\t\t<li><em>M:</em> Toggle mute</li>\r\n\t\t<li><em>R:</em> Remove video</li>\r\n\t\t<li><em>S:</em> Change video scaling</li>\r\n\t\t<li><em>X:</em> Change aspect ratio</li>\r\n\t\t<li><em>← →:</em> Skip 1m</li>\r\n\t\t<li><em>Shift ← →:</em> Skip 10%</li>\r\n\t\t<li><em>Ctrl ← →:</em> Change speed</li>\r\n\t\t<li><em>Shift+S</em> Sync speeds</li>\r\n\t\t<li><em>Ctrl+W:</em> Close tab</li>\r\n\t\t<li><em>O,O:</em> Restart video</li>\r\n\t\t<li><em>2-9:</em> Fill 2-9 size grid</li>\r\n\t\t<li><em>Drag+Drop:</em> Reorder videos</li>\r\n\t</ol>\r\n</section>\r\n\r\nconst DISCLAIMER = <footer>\r\n\t<h2>Privacy Disclaimer</h2>\r\n\t<p>This tool records <b>no</b> filenames, screen grabs, or any other methods of identifying the actual contents of any video.  Only metadata about a video's format (codec, file size, resolution, and duration) may be recorded.</p>\r\n</footer>\r\n\r\ninterface HelpSettingsProps {\r\n\tobjectFit:ObjectFitProperty,\r\n\tobjectFitCallback:(objectFit:ObjectFitProperty)=>void,\r\n\taspectRatio:AspectRatio,\r\n\taspectRatioCallback:(aspectRatio:AspectRatio)=>void\r\n}\r\n\r\nfunction getAR(aspectRatio:AspectRatio) {\r\n\treturn `${aspectRatio.ratio.toFixed(2)} / ${aspectRatio.name}`\r\n}\r\n\r\nexport function Help(props:HelpSettingsProps) {\r\n\treturn <section id=\"help\">\r\n\t\t<h2>Usage</h2>\r\n\t\t<p>Drag and drop any number of videos to auto-play in an optimally arranged grid.</p>\r\n\t\t<section id=\"settings\">\r\n\t\t\t<h2>Settings</h2>\r\n\t\t\t<form>\r\n\t\t\t\t<SelectInput\r\n\t\t\t\t\tname=\"objectScale\" label=\"Video Fit/Fill\"\r\n\t\t\t\t\tvalue={props.objectFit} choices={OBJECT_FITS.map((v, i) => <option key={i} value={v}>{v[0].toUpperCase()+v.substr(1)}</option>)}\r\n\t\t\t\t\tcallback={i => props.objectFitCallback(i as ObjectFitProperty)} /><br />\r\n\t\t\t\t<SelectInput\r\n\t\t\t\t\tname=\"aspectRatio\" label=\"Aspect Ratio\"\r\n\t\t\t\t\tvalue={ASPECT_RATIOS.indexOf(props.aspectRatio).toString()}\r\n\t\t\t\t\tchoices={ASPECT_RATIOS.map((v, i) => <option key={i} value={i}>{v.name}</option>)}\r\n\t\t\t\t\tcallback={i => props.aspectRatioCallback(ASPECT_RATIOS[parseInt(i)])} /><br />\r\n\t\t\t</form>\r\n\t\t</section>\r\n\t\t{SHORTCUTS}\r\n\t\t{DISCLAIMER}\r\n\t</section>\r\n}\r\n\r\nfunction SelectInput(props:{name:string, label:string, value:string, choices:JSX.Element[], callback:(val:string)=>void}) {\r\n\treturn <>\r\n\t\t<label htmlFor={props.name}>{props.label}</label>\r\n\t\t<select name={props.name} value={props.value} onChange={e => props.callback(e.target.value)}>\r\n\t\t\t{props.choices}\r\n\t\t</select>\r\n\t</>\r\n}\r\n\r\nfunction NumInput(props:{value:number, name:string, label:string, callback:(num:number)=>void}) {\r\n\treturn <>\r\n\t\t<label htmlFor={props.name}>{props.label}</label>\r\n\t\t<input type=\"number\" min={0} maxLength={3} name={props.name} value={props.value} onChange={e => props.callback(parseFloat(e.target.value))} />\r\n\t</>\r\n}\r\n\r\nexport default Help","// TODO: import only required polyfills\n// import 'react-app-polyfill/ie11'\nimport '@babel/polyfill'\n// import 'core-js/modules/es6.array.from'\nimport React from 'react'\nimport './App.css'\nimport { BDVideo, Display } from './BDVideo'\nimport {AspectRatio, ASPECT_RATIOS} from './AspectRatio'\nimport Help from './Help'\nimport { toggleFullscreen } from './FullScreen'\nimport { ObjectFitProperty } from \"csstype\"\n\nexport const OBJECT_FITS = ['contain', 'cover', 'fill', 'scale-down'] as ObjectFitProperty[]\n\nconst avg = (arr:number[]) => arr.reduce((a, b) => a + b, 0) / arr.length\n\n// TODO: refence react as third party library on cdn?\n\n// TODO: add logo\nconst SPLASH = <section id=\"splash\">\n\t<p>Auto-play any number of videos or copies of videos in an optimally arranged grid with simple drag-and-drop.  Videos start half-way in and loop, ensuring immediate, continuous immersion, great for scouring surveillance footage, finding the best highlights from your last gaming stream, and more!</p>\n\t<p>Find your favourite moments quickly with thumbnail scrubbing and keyboard shortcuts to jump ahead in time 1m (→) or 10% (Shift →), or adjust playback speed (Ctrl →).</p>\n\t<p>Use shortcut keys to rapidly (c)opy or (r)emove displays, set (i)n/(o)ut loop points, (f)ullscreen the display, toggle (m)ute, etc.</p>\n\t{/* <img src=\"clipart/surveillance.jpg\" alt=\"Surveillance\" />\n\t<img src=\"clipart/television.jpg\" alt=\"Television\" /> */}\n</section>\n\nfunction stopDragDrop(e:Event) {\n\te.preventDefault()\n\te.stopPropagation()\n}\n\ninterface Dimensions {\n\tx:number,\n\ty:number\n}\n\ninterface AppState {\n\tshowHelp:boolean,\n\tshowThumbnails:boolean,\n\tdisplays:Display[],\n\tmaxId:number,\n\tactiveDisplay?:Display,\n\tlastDisplay?:Display,\n\tviewport?:Dimensions,\n\tratioIndex:number,\n\taspectRatio:AspectRatio,\n\tobjectFitIndex:number,\n\tobjectFit:ObjectFitProperty,\n\tfirstBatch:boolean,\n\terrorDisplays:Display[],\n\tdragSrc?:Display\n}\n\ninterface ActionControls {\n\t[key:string]: ()=>void\n}\n\nclass App extends React.Component<{},AppState> {\n\tviewport = React.createRef<HTMLElement>()\n\tglobalActions = {\n\t\t\"f\": () => toggleFullscreen(),\n\t\t\"h\": () => this.setState({showHelp: !this.state.showHelp}),\n\t\t\"s\": () => this.nextObjectFit(),\n\t\t\"t\": () => this.setState({showThumbnails: !this.state.showThumbnails}),\n\t\t\"x\": () => this.nextDimensionRatio()\n\t} as ActionControls\n\n\tsyncPlaybackRates(playbackRate:number) {\n\t\tconst {displays} = this.state\n\t\tdisplays.forEach(i => i.playbackRate = playbackRate)\n\t\tthis.setState({displays}) \n\t}\n\n\tdistributeTimes(display:Display) {\n\t\tconst {displays} = this.state\n\t\tconst matchingDisplays = displays.filter(i => i.file == display.file)\n\t\tconst di = matchingDisplays.indexOf(display)\n\t\t// start with target display so it keeps its current time, bump up from there looping back to start\n\t\tconst orderedDisplays = [display, ...matchingDisplays.slice(di+1), ...matchingDisplays.slice(0, di)]\n\n\t\tconst t1 = display.video!.currentTime\n\t\tconst duration = display.video!.duration\n\t\tconst spacing = duration / orderedDisplays.length\n\t\torderedDisplays.forEach((v, i) => {\n\t\t\tconst targetTime = t1 + (spacing * i)\n\t\t\t// loop time back to beginning once we exceed end of video\n\t\t\tv.video!.currentTime = targetTime < duration ? targetTime : targetTime - duration\n\t\t})\n\t}\n\n\tfillGrid(display:Display, count:number) {\n\t\tconst {displays} = this.state\n\t\tconst additions = count - displays.length\n\t\tif (additions < 1) return\n\t\tconst newDisplays = [...Array(additions)].map((_, i) => {\n\t\t\tconst newDisplay = this.copyDisplay(display)\n\t\t\tnewDisplay.id += i\n\t\t\treturn newDisplay\n\t\t})\n\t\tthis.setState({\n\t\t\tdisplays: displays.concat(newDisplays),\n\t\t\tmaxId: newDisplays.pop()!.id\n\t\t})\n\t}\n\n\tconstructor(props:{}) {\n\t\tsuper(props)\n\t\tthis.state = {\n\t\t\tshowHelp: true,\n\t\t\tshowThumbnails: true,\n\t\t\tdisplays: [],\n\t\t\tmaxId: 0,\n\t\t\tratioIndex: 0,\n\t\t\taspectRatio: ASPECT_RATIOS[0],\n\t\t\tobjectFitIndex: 0,\n\t\t\tobjectFit: OBJECT_FITS[0],\n\t\t\tfirstBatch: true,\n\t\t\terrorDisplays: [],\n\t\t}\n\n\t\t// const testState = {\n\t\t// \tdisplays: [{\n\t\t// \t\tid: 1,\n\t\t// \t\tfile: new File([], \"test\"),\n\t\t// \t\turl: \"2.mp4\",\n\t\t// \t\ttriggerResize: true,\n\t\t// \t\tplaybackRate: 1\n\t\t// \t}],\n\t\t// \tmaxId: 1,\n\t\t// \tfirstBatch: false,\n\t\t// \tshowHelp: false\n\t\t// }\n\t\t// this.state = Object.assign({}, this.state, testState)\n\n\t\twindow.onresize = this.updateDimensions\n\n\t\twindow.onkeydown = this.handleKeyPress\n\n\t\tdocument.ondragover = stopDragDrop\n\t\tdocument.ondragenter = stopDragDrop\n\t\tdocument.ondragleave = stopDragDrop\n\t\tdocument.ondrop = this.handleDropEvent\n\t}\n\n\thandleDropEvent = (e:DragEvent) => {\n\t\tstopDragDrop(e)\n\t\tif (!e.dataTransfer) return\n\t\tconst {firstBatch} = this.state\n\t\tconst droppedFiles = e.dataTransfer.files as FileList\n\t\tconst videoFiles = Array.from(droppedFiles).filter(i => i.type.startsWith('video/'))\n\t\tlet maxId = this.state.maxId\n\t\tconst newDisplays = videoFiles.map(file => ({\n\t\t\tid: ++maxId,\n\t\t\tfile,\n\t\t\turl: URL.createObjectURL(file),\n\t\t\ttriggerResize: firstBatch,\n\t\t\tplaybackRate: 1\n\t\t} as Display))\n\n\t\tthis.setState({\n\t\t\tdisplays: this.state.displays.concat(newDisplays),\n\t\t\tmaxId,\n\t\t\tfirstBatch: false,\n\t\t\t// hide help if we are adding videos\n\t\t\tshowHelp: this.state.showHelp && videoFiles.length == 0\n\t\t})\n\t}\n\n\thandleKeyPress = (ev:KeyboardEvent) => {\n\t\tconst key = ev.key.toLowerCase()\n\t\tif (key in this.globalActions && !ev.shiftKey && !ev.ctrlKey) {\n\t\t\tthis.globalActions[key]()\n\t\t\treturn\n\t\t}\n\n\t\tconst d = this.state.activeDisplay\n\t\tif (!d) return\n\n\t\tif (ev.shiftKey) {\n\t\t\tconst shiftDisplayActions = {\n\t\t\t\t\"s\": () => this.syncPlaybackRates(d.playbackRate),\n\t\t\t} as ActionControls\n\t\t\tkey in shiftDisplayActions && shiftDisplayActions[key]()\n\t\t} else if (ev.ctrlKey) {\n\t\t\tconst ctrlDisplayActions = {\n\t\t\t\t\"arrowleft\": () => this.adjustVideoSpeed(d, 0.5),\n\t\t\t\t\"arrowright\": () => this.adjustVideoSpeed(d, 2)\n\t\t\t} as ActionControls\n\t\t\tkey in ctrlDisplayActions && ctrlDisplayActions[key]()\n\t\t} else {\n\t\t\tconst displayActions = {\n\t\t\t\t\"delete\": () => this.deleteDisplay(d),\n\t\t\t\t\"c\": () => this.addDisplayCopy(d),\n\t\t\t\t\"d\": () => this.distributeTimes(d),\n\t\t\t\t\"e\": () => this.setState({displays: [d]}),\n\t\t\t\t\"i\": () => this.setVideoIO(d, \"in\"),\n\t\t\t\t\"o\": () => this.setVideoIO(d, \"out\"),\n\t\t\t\t\"r\": () => this.deleteDisplay(d),\n\t\t\t} as ActionControls\n\t\t\tkey in displayActions && displayActions[key]()\n\t\t\tif (key >= \"2\" && key <= \"9\") {\n\t\t\t\tthis.fillGrid(d, parseInt(key))\n\t\t\t\tthis.distributeTimes(d)\n\t\t\t}\n\t\t}\n\t}\n\n\tgetVideoSize() {\n\t\tconst {displays, aspectRatio, viewport} = this.state\n\t\t// assume minimum size if no viewport (shouldn't happen)\n\t\tif (!viewport) return {width: 1, height: 1}\n\t\t// if only one display, use full size\n\t\tif (displays.length < 2) return {width: viewport.x, height: viewport.y}\n\n\t\t// try every number of rows up to a dedicated row for each video\n\t\tlet bestArea = 0, width = 0, height = 0\n\t\tconst videoRatio = aspectRatio.ratio\n\t\tfor (let rows = 1; rows <= displays.length; rows++) {\n\t\t\t// get the necessary number of columns with a given number of rows\n\t\t\tconst cols = Math.ceil(displays.length / rows)\n\t\t\t// this determines the size of the resulting box\n\t\t\tconst x = Math.floor(viewport.x / cols)\n\t\t\tconst y = Math.floor(viewport.y / rows)\n\t\t\t// actual video dimensions will depend on ratio within the display box, being shrunk on one side\n\t\t\tlet vx = x, vy = y\n\t\t\tif (videoRatio > x/y) {\n\t\t\t\tvy = vx / videoRatio\n\t\t\t} else {\n\t\t\t\tvx = vy * videoRatio\n\t\t\t}\n\t\t\tconst videoArea = vx * vy\n\t\t\t// if this isn't an improvement, continue looking\n\t\t\tif (videoArea < bestArea) continue\n\t\t\t// otherwise save this as best situation\n\t\t\tbestArea = videoArea\n\t\t\twidth = x, height = y\n\t\t}\n\n\t\treturn {width, height}\n\t}\n\n\tadjustVideoSpeed(display:Display, adjustment:number) {\n\t\tdisplay.playbackRate = display.playbackRate * adjustment\n\t\tthis.setState({displays: this.state.displays})\n\t}\n\n\tsetVideoIO(display:Display, mode:\"in\"|\"out\") {\n\t\tif (mode in display) {\n\t\t\tdelete display[mode]\n\t\t} else {\n\t\t\tdisplay[mode] = display.video!.currentTime\n\t\t}\n\t\t// not sure if this way of updating the display will work\n\t\tthis.setState({displays: this.state.displays})\n\t}\n\n\tupdateDimensions = () => {\n\t\tconst vp = this.viewport.current!\n\t\tconst viewport = {x: vp.clientWidth, y: vp.clientHeight}\n\t\tthis.setState({viewport})\n\t}\n\n\tcopyDisplay(display:Display) {\n\t\tconst activeVideo = display.video!\n\t\tconst maxId = this.state.maxId + 1\n\t\tlet startTime = activeVideo.currentTime + 60\n\t\tif (startTime > activeVideo.duration) startTime = 0\n\t\tconst newDisplay = {\n\t\t\tid: maxId,\n\t\t\tfile: display.file,\n\t\t\turl: display.url,\n\t\t\tplaybackRate: display.playbackRate,\n\t\t\tstartTime,\n\t\t\ttriggerResize: false\n\t\t}\n\t\treturn newDisplay\n\t}\n\n\taddDisplayCopy(display:Display) {\n\t\tconst newDisplay = this.copyDisplay(display)\n\t\tthis.setState({\n\t\t\tmaxId: newDisplay.id,\n\t\t\tdisplays: this.state.displays.concat(newDisplay)\n\t\t})\n\t}\n\n\tdeleteDisplay(display:Display) {\n\t\tthis.setState({ displays: this.state.displays.filter(i => i != display) })\n\t}\n\tapplyOnActive = (func:(display:Display)=>void) => () => this.state.activeDisplay && func.bind(this)(this.state.activeDisplay)\n\n\tnextDimensionRatio() {\n\t\tlet i = this.state.ratioIndex + 1\n\t\tif (i >= ASPECT_RATIOS.length) i = 0\n\t\tthis.setState({\n\t\t\tratioIndex: i,\n\t\t\taspectRatio: ASPECT_RATIOS[i]\n\t\t})\n\t}\n\n\tnextObjectFit() {\n\t\tlet i = this.state.objectFitIndex + 1\n\t\tif (i >= OBJECT_FITS.length) i = 0\n\t\tthis.setState({\n\t\t\tobjectFitIndex: i,\n\t\t\tobjectFit: OBJECT_FITS[i]\n\t\t})\n\t}\n\n\tcomponentDidMount() {\n\t\tthis.updateDimensions()\n\t}\n\n\tgetRecommendedAspectRatioIndex() {\n\t\tconst avgRatio = avg(this.state.displays.map(i => i.video!.videoWidth / i.video!.videoHeight))\n\t\tconst closestRatio = [...ASPECT_RATIOS].sort((a, b) => Math.abs(avgRatio - b.ratio) - Math.abs(avgRatio - a.ratio)).pop()!\n\t\tconst i = ASPECT_RATIOS.findIndex(i => i.name == closestRatio.name)\n\t\treturn i\n\t}\n\n\tsetRecommendedAspectRatio() {\n\t\tconst i = this.getRecommendedAspectRatioIndex()\n\t\tthis.setState({\n\t\t\taspectRatio: ASPECT_RATIOS[i],\n\t\t\tratioIndex: i\n\t\t})\n\t}\n\n\thandleVideoError(display:Display) {\n\t\tconst {displays, errorDisplays} = this.state\n\t\terrorDisplays.push(display)\n\t\tthis.setState({\n\t\t\tdisplays: displays.filter(i => i != display),\n\t\t\terrorDisplays\n\t\t})\n\t}\n\n\treorderDisplays(dest:EventTarget) {\n\t\tconst {displays, dragSrc} = this.state\n\t\tif (!dragSrc) return\n\t\tconst destDisplay = displays.filter(i => i.video == dest).pop() || displays[displays.length-1]\n\t\tconst si = displays.indexOf(dragSrc)\n\t\tconst tmpDisplays = [...displays.slice(0, si), ...displays.slice(si+1)]\n\t\tconst di = tmpDisplays.indexOf(destDisplay)\n\t\tconst newDisplays = [...tmpDisplays.slice(0, di+1), dragSrc, ...tmpDisplays.slice(di+1)]\n\t\tthis.setState({ displays: newDisplays })\n\t}\n\n\trender() {\n\t\tconst {displays, errorDisplays, activeDisplay, lastDisplay, showThumbnails, showHelp, aspectRatio, objectFit} = this.state\n\t\tconst size = this.getVideoSize()\n\t\treturn <>\n\t\t\t<main ref={this.viewport}\n\t\t\t\tonDrop={e => this.reorderDisplays(e.target)}>\n\t\t\t\t{displays.length == 0 && SPLASH}\n\t\t\t\t{displays.map(i => <BDVideo size={size} objectFit={objectFit} key={i.id} display={i}\n\t\t\t\t\tshowOverlay={i == activeDisplay}\n\t\t\t\t\tshowThumbnail={showThumbnails}\n\t\t\t\t\tplaybackRate={i.playbackRate}\n\t\t\t\t\tonDrag={display => this.setState({dragSrc: display})}\n\t\t\t\t\tonMouseOver={() => this.setState({activeDisplay: i, lastDisplay: i})}\n\t\t\t\t\tonMouseOut={() => this.setState({activeDisplay: undefined})}\n\t\t\t\t\tonLoad={() => i.triggerResize && this.setRecommendedAspectRatio()}\n\t\t\t\t\tonError={() => this.handleVideoError(i)}\n\t\t\t\t\tinTime={i.in} outTime={i.out}\n\t\t\t\t\t// removeCallback={() => this.deleteDisplay(i)}\n\t\t\t\t\tremoveCallback={this.applyOnActive(this.deleteDisplay)}\n\t\t\t\t\tcopyCallback={() => this.addDisplayCopy(i)}\n\t\t\t\t\texclusiveCallback={() => this.setState({displays: [i]})}\n\t\t\t\t\tstaggerCallback={() => this.distributeTimes(i)}\n\t\t\t\t\tinCallback={() => this.setVideoIO(i, \"in\")}\n\t\t\t\t\toutCallback={() => this.setVideoIO(i, \"out\")}\n\t\t\t\t\tspeedCallback={adjustment => this.adjustVideoSpeed(i, adjustment)}\n\t\t\t\t/>)}\n\t\t\t</main>\n\t\t\t{errorDisplays.length > 0 && <ErrorDisplay errorDisplays={errorDisplays} dismissCallback={() => this.setState({errorDisplays: []})} />}\n\t\t\t{showHelp && <Help\n\t\t\t\t{...{aspectRatio, objectFit}}\n\t\t\t\taspectRatioCallback={aspectRatio => this.setState({aspectRatio})}\n\t\t\t\tobjectFitCallback={objectFit => this.setState({objectFit})} />}\n\t\t</>\n\t}\n}\n\ninterface ErrorDisplayProps {\n\terrorDisplays:Display[],\n\tdismissCallback:()=>void\n}\nfunction ErrorDisplay({errorDisplays, dismissCallback}:ErrorDisplayProps) {\n\treturn <section id=\"errors\">\n\t\t<h2>Errors</h2><ol>\n\t\t\t{errorDisplays.map((display, i) => <li key={i}>{display.file.name} ({display.file.type})</li>)}\n\t\t</ol>\n\t\t<p>Only videos supported by your web browser will play successfully.  <code>.mp4</code> and <code>.webm</code> files are good bets.</p>\n\t\t<form onSubmit={dismissCallback}><button>Dismiss</button></form>\n\t</section>\n}\n\nexport default App","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react'\nimport ReactDOM from 'react-dom'\nimport App from './App'\nimport * as serviceWorker from './serviceWorker'\n\nReactDOM.render(<App />, document.getElementById('root'))\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\n// serviceWorker.unregister()\nserviceWorker.register()\n"],"sourceRoot":""}